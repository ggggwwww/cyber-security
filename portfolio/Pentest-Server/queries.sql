CREATE DATABASE pentestDB;
USE pentestDB;

CREATE USER 'dbmaster'@'localhost' IDENTIFIED BY '1234';
GRANT ALL PRIVILEGES ON pentestDB.* TO 'dbmaster'@'localhost';
FLUSH PRIVILEGES;

CREATE TABLE users (
    id VARCHAR(50) PRIMARY KEY NOT NULL,
    username VARCHAR(50) NOT NULL,
    pw VARCHAR(255) NOT NULL,
    sex ENUM('male','female'),
    birth DATE,
    address VARCHAR(255),
    phone VARCHAR(20) UNIQUE NOT NULL,
    role ENUM('patient','doctor','admin') DEFAULT 'patient',
    profile_image VARCHAR(255) DEFAULT '/profile/images/default.png' /*해당 경로는 apache2의 기본경로 웹페이지 저장 경로(/var/www/html)를 기준으로 작성됨*/
);

CREATE TABLE patient_info(
    id INT AUTO_INCREMENT PRIMARY KEY,
    username VARCHAR(50) NOT NULL,
    chronic_disease TEXT NOT NULL,
    allergy TEXT,
    FOREIGN KEY (username) REFERENCES users(username)
);

CREATE TABLE boards (
    id INT AUTO_INCREMENT PRIMARY KEY,
    username VARCHAR(50) NOT NULL,
    title VARCHAR(100) NOT NULL,
    content TEXT NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    board_type VARCHAR(20),
    FOREIGN KEY (username) REFERENCES users(username)
);

CREATE TABLE patient_records (
    id INT AUTO_INCREMENT PRIMARY KEY,
    username VARCHAR(50) NOT NULL,
    record TEXT NOT NULL,
    prescription TEXT NOT NULL,
    FOREIGN KEY (username) REFERENCES users(username)
);

CREATE TABLE reservations (
    id INT AUTO_INCREMENT PRIMARY KEY,
    patient_username VARCHAR(50) NOT NULL,
    doctor_username VARCHAR(50) NOT NULL,
    reservation_date DATE NOT NULL,
    reservation_time TIME NOT NULL,
    _status VARCHAR(20) DEFAULT 'pending',
    FOREIGN KEY (patient_username) REFERENCES users(username),
    FOREIGN KEY (doctor_username) REFERENCES users(username)
);


CREATE TABLE uploads(
    id INT AUTO_INCREMENT PRIMARY KEY,
    filename VARCHAR(255) NOT NULL,
    uploaded_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

# Sample Data
INSERT INTO users (id, username, pw, sex, birth, address, phone, role) VALUES
('admin', 'Administrator', 'admin', 'male', '1980-01-01', '123 Admin St', '010-0000-0000', 'admin'),
('doctor1', 'Dr. Smith', 'pass', 'male', '1975-05-20', '456 Doctor Rd', '010-1111-1111', 'doctor'),
('patient1', 'Jane Doe', 'pass', 'female', '1990-10-10', '789 Patient Ave', '010-2222-2222', 'patient');

INSERT INTO users (id, username, pw, sex, birth, address, phone, role) VALUES
('doctor2', 'Dr. Johnson', 'pass', 'female', '1982-03-15', '321 Doctor Blvd', '010-3333-3333', 'doctor');  