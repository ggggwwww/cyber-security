<?php

    $user_id = $_POST['user_id'];
    $pw = $_POST['pw'];
    $name = $_POST['name'];
    $sex = $_POST['sex'];
    $birth_date = $_POST['birth_date'];
    $address = $_POST['address'];
    $phone = $_POST['phone'];

    // 데이터베이스 연결
    $servername = "localhost";
    $username = "dbmaster";
    $password = "1234";
    $dbname = "pentestDB";

    $conn = new mysqli($servername, $username, $password, $dbname);
    if ($conn->connect_error) {
        die("DB 연결 실패: " . $conn->connect_error);
    }
    // 사용자 등록
    $sql = "INSERT INTO users (id, username, pw, sex, birth, address, phone) VALUES ('$user_id', '$name', '$pw', '$sex', '$birth_date', '$address', '$phone')";
    $result = $conn -> query($sql);

    $errorMsg = $conn->error; // 예: Duplicate entry '010-1234-5678' for key 'phone'
    if (preg_match("/for key '([^']+)'/", $errorMsg, $matches)) {
        $duplicateKey = $matches[1]; // 결과: phone
        echo "중복 컬럼(인덱스): " . $duplicateKey;
    }
    else{
        if($result === TRUE){
        echo "<script>alert('회원가입이 완료되었습니다.');</script>";
        echo "<script>window.location.href = '../index.php';</script>";
        } else {
            echo "<script>alert('회원가입에 실패했습니다: " . $conn->error . "');</script>";
            echo "<script>window.location.href = 'register_view.php';</script>";
        }
    }
    

    $conn->close();
?>