<?php
session_start();
?>
<html>
    <head>
        <title>나의 진료 기록</title>
    </head>
    <body>
        <h1>나의 진료 기록</h1>
        <?php
            $servername = "localhost";  // DB 서버 주소
            $username = "dbmaster";     // DB 사용자명
            $password = "1234";         // DB 비밀번호
            $dbname = "pentestDB";      // DB 이름

            $conn = new mysqli($servername, $username, $password, $dbname);
            if ($conn->connect_error) {
                die("DB 연결 실패: " . $conn->connect_error);
            }
            if (isset($_SESSION['username'])) {
                $patient_username = $_SESSION['username'];
                $sql = "SELECT * FROM patient_records WHERE username = '" . $patient_username . "'";
                $result = $conn->query($sql);
                if ($result->num_rows > 0) {
                    echo "<table border='1'><tr><th>진료 내용</th><th>처방전 내용</th></tr>";
                    while($row = $result->fetch_assoc()) {
                        echo "<tr>";
                        echo "<td>" . nl2br(htmlspecialchars($row['record'])) . "</td>";
                        echo "<td>" . nl2br(htmlspecialchars($row['prescription'])) . "</td>";
                        echo "</tr>";
                    }
                    echo "</table>";
                } else {
                    echo "<p>진료 기록이 없습니다.</p>";
                }
            } else {
                echo "<p>로그인이 필요합니다.</p>";
            }
            $conn->close();
        ?>
    </body>
</html>
