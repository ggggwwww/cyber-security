<?php
    session_start();
?>
<html>
    <head>
        <link rel="stylesheet" type="text/css" href="../css/patient.css"/>
        <title>진료 예약 페이지</title>
    </head>

    <body>
        <div class="header-bar"><h1>SecuriCare</h1></div>
        <div class="main-content">  
            <h2>진료 예약</h2>
            <form action="submit_reservation.php" method="POST">
                <label for="reservation_date">예약 날짜:</label>
                <input type="date" id="reservation_date" name="reservation_date" min="<?php echo date('Y-m-d', strtotime('+1 day')); ?>" required><br><br>
                <label for="reservation_time">예약 시간:</label>
                <input type="time" id="reservation_time" name="reservation_time" min="<?php echo date('H:i'); ?>" required><br><br>
                <label for="status">몸 상태:</label><br>
                <textarea id="status" name="status" rows="4" cols="50"></textarea><br><br>
                <label for="doctor_username">의사 선택:</label>
                <select id="doctor_username" name="doctor_username" required>
                    <?php
                        $servername = "localhost";  // DB 서버 주소
                        $username = "dbmaster";     // DB 사용자명
                        $password = "1234";         // DB 비밀번호
                        $dbname = "pentestDB";      // DB 이름

                        $conn = new mysqli($servername, $username, $password, $dbname);
                        if ($conn->connect_error) {
                            die("DB 연결 실패: " . $conn->connect_error);
                        }  
                        $sql="SELECT username FROM users WHERE role='doctor'";
                        $result = $conn->query($sql);
                        if ($result->num_rows > 0) {
                            while($row = $result->fetch_assoc()) {
                                echo '<option value="'.htmlspecialchars($row["username"]).'">'.htmlspecialchars($row["username"]).'</option>';
                            }
                        } else {
                            echo '<option value="">등록된 의사가 없습니다.</option>';
                        }
                    ?>
                </select><br><br>
                <input type="submit" value="예약하기">
            </form>
        </div>
    </body>
</html>