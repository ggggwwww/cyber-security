<?php
session_start();
if($_SESSION['role'] != 'admin') {
    header('Location: ../index.php');
    exit();
}
?>
<html>
    <head>
        <title>사용자 관리</title>
    </head>
    <body>
        <h1>사용자 관리</h1>
        <section>
            <p>여기에서 사용자를 관리할 수 있습니다.</p>
            <?php
                $servername = "localhost";
                $username = "dbmaster";
                $password = "1234";
                $dbname = "pentestDB";

                $conn = new mysqli($servername, $username, $password, $dbname);
                if ($conn->connect_error) {
                    die("DB 연결 실패: " . $conn->connect_error);
                }
                $sql = "SELECT * FROM users";
                $result = $conn->query($sql);
                if ($result->num_rows > 0) {
                    echo "<table border='1'>
                            <tr>
                                <th>ID</th>
                                <th>이름</th>
                                <th>역할</th>
                                <th>관리</th>
                            </tr>";
                    while ($row = $result->fetch_assoc()) {
                        
                        echo "<tr>
                            <td>" . $row['id'] . "</td>
                            <td>" . $row['username'] . "</td>
                            <td>" . $row['role'] . "</td>
                            <td>
                                <form style='display:inline;' method='POST' action='edit_user.php'>
                                    <input type='hidden' name='id' value='" . $row['id'] . "'>
                                    <input type='hidden' name='username' value='" . $row['username'] . "'>
                                    <input type='hidden' name='role' value='" . $row['role'] . "'>
                                    <button type='submit'>수정</button>
                                </form>
                                <form style='display:inline;' method='POST' action='delete_user.php' onsubmit=\"return confirm('정말로 삭제하시겠습니까?');\">
                                    <input type='hidden' name='id' value='" . $row['id'] . "'>
                                    <button type='submit'>삭제</button>
                                </form>
                            </td>
                        </tr>";
                    }
                    echo "</table>";
                }
            ?>
        </section>
    </body>
</html>
