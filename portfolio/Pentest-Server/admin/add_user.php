<?php
    session_start();

    if(!isset($_SESSION['role']) || $_SESSION['role'] != 'admin') {
        header('Location: ../index.php');
        exit();
    }
    if($_SERVER['REQUEST_METHOD'] == 'POST'){

        $servername = "localhost";
        $username = "dbmaster";
        $password = "1234";
        $dbname = "pentestDB";
        $conn = new mysqli($servername, $username, $password, $dbname);
        if ($conn->connect_error) {
            die("DB 연결 실패: " . $conn->connect_error);
        }

        $id = $_POST['id'];
        $username = $_POST['username'];
        $pw = $_POST['pw'];
        $role = $_POST['role'];
        $sex = $_POST['sex'];
        $address = $_POST['address'];
        $birth = $_POST['birth'];
        $phone = $_POST['phone'];


        $sql = "INSERT INTO users (id, username, pw, role, sex, address, birth, phone) VALUES ('" . $id . "', '" . $username . "', '" . $pw . "', '" . $role . "', '" . $sex . "', '" . $address . "', '" . $birth . "', '" . $phone . "')";
    
        if ($conn->query($sql) === TRUE) {
            echo "<script>alert('새 사용자가 성공적으로 추가되었습니다.'); window.location.href = '/admin/user_management.php';</script>";
        } else {
            echo "<script>alert('오류 발생: " . $conn->error . "'); window.location.href = '/admin/user_management.php';</script>";
        }
        $conn->close();
    }
?>