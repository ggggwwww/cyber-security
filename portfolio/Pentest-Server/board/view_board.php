<?php
    session_start();
?>
<html>
    <head>
        <title>게시판</title>
        <link rel="stylesheet" type="text/css" href="../css/board.css"/>
    </head>
    <body>
        <?php
            $servername = "localhost";
            $username = "dbmaster";
            $password = "1234";
            $dbname = "pentestDB";

            $conn = new mysqli($servername, $username, $password, $dbname);
            if ($conn->connect_error) {
                die("DB 연결 실패: " . $conn->connect_error);
            }

            $board_type = $_POST['board_type'];
            $id = intval($_POST['id']);
            $sql = "SELECT * from boards where id='" . $id . "' ORDER BY created_at DESC";
            $result = $conn->query($sql);
            $row = $result->fetch_assoc();
            echo "
                <div style='margin-bottom:20px;'>
                    <a href='/board/".$board_type."_view.php'>[목록으로]</a>
                </div>
                <div class='boardTitle'>
                    <h3>".htmlspecialchars($row['title'])."</h3>
                </div>
                <div class='boardInfo' style='margin-bottom:10px;'>
                    <span style='display:inline-block; margin-right:15px;'>
                        <strong>작성자</strong>: ".htmlspecialchars($row['username'])."
                    </span><br/>
                    <span style='display:inline-block; margin-top:2px; color:gray; font-size:0.95em;'>
                        <strong>작성일</strong>: ".$row['created_at']."
                    </span>
                </div>
                <p>".nl2br(htmlspecialchars($row['content']))."</p>
            ";

            if(isset($_SESSION['username']) &&$_SESSION['username'] == $row['username']){
                echo "<hr/>";
                echo "<form method='post' action='/board/delete_board.php'>
                            <input type='hidden' name='id' value='".$row['id']."'>
                            <input type='hidden' name='username' value='".$_SESSION['username']."'>
                            <input type='hidden' name='board_type' value='".$board_type."'>
                            <button type='submit' onclick=\"return confirm('정말로 삭제하시겠습니까?');\">삭제</button>
                        </form>
                ";

            }
            $conn->close();
        ?>
    </body>
</html>