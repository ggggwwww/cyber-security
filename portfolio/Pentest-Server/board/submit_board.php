<?php
    session_start();

    if($_SERVER['REQUEST_METHOD'] === 'POST'){
         $servername = "localhost";
        $username = "dbmaster";
        $password = "1234";
        $dbname = "pentestDB";

        $conn = new mysqli($servername, $username, $password, $dbname);
        if ($conn->connect_error) {
            die("DB 연결 실패: " . $conn->connect_error);
        }
        
        $title = $_POST['title'];
        $content = $_POST['content'];
        $board_type = $_POST['board_type'];
        $username = $_SESSION['username'];

        $sql = "INSERT INTO boards (username, title, content, board_type) VALUES ('" . $username . "', '" . $title . "', '" . $content . "', '" . $board_type . "')";
        
        // 리다이렉트 경로 지정 함수
        function redirect_board($type, $errorMsg = '') {
            if ($errorMsg) echo "<script>alert('$errorMsg');</script>";
            $url = '';
            if ($type === 'feedback') $url = '/board/feedback_view.php';
            else if ($type === 'errReport') $url = '/board/errorReport_view.php';
            else if ($type === 'notice') $url = '/board/notice_view.php';
            if ($url) echo "<script>window.location.href = '$url';</script>";
        }
        if ($conn->query($sql) === TRUE) {
            redirect_board($board_type, '게시물이 성공적으로 제출되었습니다.');
        } else {
            redirect_board($board_type, '게시물 제출 중 오류가 발생했습니다: ' . $conn->error);
        }
        $conn->close();
    }
?>